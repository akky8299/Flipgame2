<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CoinFlip Game</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { background: #0f0f1e; color: white; }
    .container { max-width: 1200px; margin: auto; padding: 20px; text-align: center; }
    .lang-switch { position: absolute; top: 20px; right: 20px; font-size: 14px; }
    button { padding: 10px 20px; margin: 5px; border: none; border-radius: 8px; cursor: pointer; }
    .btn-primary { background: #007bff; color: white; }
    .btn-success { background: #28a745; color: white; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-warning { background: #ffc107; color: black; }
    .wallet { position: fixed; top: 20px; left: 20px; background: #222; padding: 10px; border-radius: 8px; font-weight: bold; }
    .coin { width: 150px; height: 150px; margin: 30px auto; background: #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; transition: transform 2s; }
    .flip { animation: flip 2s ease; }
    @keyframes flip { 0% { transform: rotateY(0); } 100% { transform: rotateY(1800deg); } }
    .countdown { font-size: 32px; margin: 20px; color: #ffc107; }
    .bet-area { margin: 20px; }
    .bet-btn { background: #444; color: white; }
    .result { font-size: 24px; margin: 20px; color: #00ff00; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; }
    .modal-content { background: #1e1e2f; padding: 30px; border-radius: 12px; width: 90%; max-width: 500px; }
    input, select { width: 100%; padding: 10px; margin: 10px 0; border-radius: 6px; border: 1px solid #444; background: #222; color: white; }
    .active-boss { margin: 20px 0; }
    .user-list { text-align: left; margin-top: 10px; }
    .user-item { padding: 8px; background: #222; margin: 5px 0; border-radius: 6px; }
    .green-light { display: inline-block; width: 12px; height: 12px; background: #0f0; border-radius: 50%; margin-right: 8px; }
    footer { margin-top: 50px; color: #aaa; font-size: 12px; }
  </style>
</head>
<body>
  <div class="lang-switch">
    <button id="langToggle">Switch to English</button>
  </div>

  <div class="wallet" id="wallet">₹0</div>

  <div class="container" id="app">
    <!-- Login Screen -->
    <div id="loginScreen">
      <h1 id="title">कॉइन फ्लिप गेम</h1>
      <p id="desc">Google खाते से साइन इन करें</p>
      <button id="googleLogin" class="btn-primary">Google से साइन इन करें</button>
    </div>

    <!-- Signup Referral Screen -->
    <div id="signupScreen" style="display:none;">
      <h2 id="refTitle">साइन अप करें</h2>
      <p id="refDesc">रेफरल आईडी (वैकल्पिक)</p>
      <input type="text" id="referralInput" placeholder="रेफरल आईडी डालें" />
      <button id="submitSignup" class="btn-success">जारी रखें</button>
    </div>

    <!-- Main Game -->
    <div id="gameScreen" style="display:none;">
      <h1 id="gameTitle">कॉइन फ्लिप गेम</h1>
      <div class="countdown" id="countdown">अगला राउंड: --</div>
      <div class="coin" id="coin">?</div>
      <div class="result" id="result"></div>

      <div class="bet-area">
        <h3 id="betTitle">दांव लगाएं</h3>
        <div>
          <button class="bet-btn" data-amount="10">₹10</button>
          <button class="bet-btn" data-amount="20">₹20</button>
          <button class="bet-btn" data-amount="50">₹50</button>
          <button class="bet-btn" data-amount="100">₹100</button>
          <button class="bet-btn" data-amount="500">₹500</button>
        </div>
        <div>
          <button id="betHeads" class="btn-primary" disabled>चित</button>
          <button id="betTails" class="btn-warning" disabled>पट</button>
        </div>
      </div>

      <div class="active-boss">
        <h3 id="bossTitle">एक्टिव बॉस चुनें</h3>
        <select id="bossSelect">
          <option value="">कोई बॉस नहीं</option>
        </select>
        <div class="user-list" id="userList"></div>
      </div>

      <!-- Navigation -->
      <div>
        <button id="profileBtn" class="btn-success">प्रोफ़ाइल</button>
        <button id="walletBtn" class="btn-warning">वॉलेट</button>
        <button id="logoutBtn" class="btn-danger">लॉग आउट</button>
      </div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div class="modal" id="profileModal">
    <div class="modal-content">
      <h2>प्रोफ़ाइल</h2>
      <p>UID: <span id="profileUid"></span></p>
      <p>ईमेल: <span id="profileEmail"></span></p>
      <p>कुल लाभ: ₹<span id="totalProfit">0</span></p>
      <p>कुल नुकसान: ₹<span id="totalLoss">0</span></p>
      <p>सक्रिय समय: <span id="activeTime">0 मिनट</span></p>
      <button onclick="closeModal('profileModal')">बंद करें</button>
    </div>
  </div>

  <!-- Wallet Modal -->
  <div class="modal" id="walletModal">
    <div class="modal-content">
      <h2>वॉलेट</h2>
      <p>कुल शेष: ₹<span id="walletBalance">0</span></p>
      <input type="number" id="addAmount" placeholder="राशि जोड़ें (₹200+)" min="200" />
      <button id="addMoneyBtn" class="btn-success">पैसे जोड़ें</button>
      <input type="number" id="withdrawAmount" placeholder="निकालें (₹4000+)" min="4000" />
      <button id="withdrawBtn" class="btn-danger">निकालें</button>
      <button onclick="closeModal('walletModal')">बंद करें</button>
    </div>
  </div>

  <footer>© 2025 CoinFlip Game. All rights reserved.</footer>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAWFRw8XzqGF011OdzRO8WzaXcCF5Uzsxg",
      authDomain: "flipcoin-1030e.firebaseapp.com",
      databaseURL: "https://flipcoin-1030e-default-rtdb.firebaseio.com",
      projectId: "flipcoin-1030e",
      storageBucket: "flipcoin-1030e.firebasestorage.app",
      messagingSenderId: "485574721435",
      appId: "1:485574721435:web:9c4713a57521128f122b3e",
      measurementId: "G-JKG0KTMTBQ"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Language Toggle
    let lang = 'hi';
    const translations = {
      hi: {
        title: "कॉइन फ्लिप गेम",
        desc: "Google खाते से साइन इन करें",
        refTitle: "साइन अप करें",
        refDesc: "रेफरल आईडी (वैकल्पिक)",
        gameTitle: "कॉइन फ्लिप गेम",
        betTitle: "दांव लगाएं",
        bossTitle: "एक्टिव बॉस चुनें",
        langSwitch: "Switch to English",
        logout: "लॉग आउट",
        profile: "प्रोफ़ाइल",
        wallet: "वॉलेट"
      },
      en: {
        title: "Coin Flip Game",
        desc: "Sign in with Google Account",
        refTitle: "Sign Up",
        refDesc: "Referral ID (Optional)",
        gameTitle: "Coin Flip Game",
        betTitle: "Place Bet",
        bossTitle: "Select Active Boss",
        langSwitch: "हिंदी में बदलें",
        logout: "Log Out",
        profile: "Profile",
        wallet: "Wallet"
      }
    };

    document.getElementById("langToggle").onclick = () => {
      lang = lang === 'hi' ? 'en' : 'hi';
      updateLanguage();
    };

    function updateLanguage() {
      const t = translations[lang];
      document.getElementById("title").textContent = t.title;
      document.getElementById("desc").textContent = t.desc;
      document.getElementById("refTitle").textContent = t.refTitle;
      document.getElementById("refDesc").textContent = t.refDesc;
      document.getElementById("gameTitle").textContent = t.gameTitle;
      document.getElementById("betTitle").textContent = t.betTitle;
      document.getElementById("bossTitle").textContent = t.bossTitle;
      document.getElementById("langToggle").textContent = t.langSwitch;
      document.getElementById("logoutBtn").textContent = t.logout;
      document.getElementById("profileBtn").textContent = t.profile;
      document.getElementById("walletBtn").textContent = t.wallet;
    }

    // Auth
    const googleLogin = document.getElementById("googleLogin");
    const loginScreen = document.getElementById("loginScreen");
    const signupScreen = document.getElementById("signupScreen");
    const gameScreen = document.getElementById("gameScreen");
    const submitSignup = document.getElementById("submitSignup");

    googleLogin.onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider);
    };

    auth.onAuthStateChanged(user => {
      if (user) {
        const userRef = db.ref("users/" + user.uid);
        userRef.once("value").then(snapshot => {
          if (!snapshot.exists()) {
            signupScreen.style.display = "block";
            loginScreen.style.display = "none";
          } else {
            showGame(user);
          }
        });
      } else {
        loginScreen.style.display = "block";
        signupScreen.style.display = "none";
        gameScreen.style.display = "none";
      }
    });

    submitSignup.onclick = () => {
      const user = auth.currentUser;
      const referralId = document.getElementById("referralInput").value.trim();
      const userData = {
        uid: user.uid,
        email: user.email,
        displayName: user.displayName,
        photoURL: user.photoURL,
        balance: 0,
        referralId: referralId || null,
        totalProfit: 0,
        totalLoss: 0,
        activeTime: 0,
        joinedAt: new Date().toISOString(),
        lastActive: new Date().toISOString()
      };

      if (referralId) {
        db.ref("referrals/" + referralId).push(user.uid).then(() => {
          db.ref("users/" + user.uid).set(userData);
          db.ref("users/" + user.uid + "/balance").transaction(current => {
            return (current || 0) >= 1 ? current : 100;
          });
          alert("₹100 बोनस मिला!");
          showGame(user);
        });
      } else {
        db.ref("users/" + user.uid).set(userData);
        showGame(user);
      }
    };

    function showGame(user) {
      loginScreen.style.display = "none";
      signupScreen.style.display = "none";
      gameScreen.style.display = "block";
      document.getElementById("wallet").textContent = "₹0";
      loadBosses();
      setupRealtimeGame(user);
      setupNavigation(user);
    }

    function setupNavigation(user) {
      document.getElementById("logoutBtn").onclick = () => {
        auth.signOut();
      };

      document.getElementById("profileBtn").onclick = () => {
        const modal = document.getElementById("profileModal");
        db.ref("users/" + user.uid).once("value").then(snap => {
          const data = snap.val();
          document.getElementById("profileUid").textContent = data.uid;
          document.getElementById("profileEmail").textContent = data.email;
          document.getElementById("totalProfit").textContent = data.totalProfit || 0;
          document.getElementById("totalLoss").textContent = data.totalLoss || 0;
          document.getElementById("activeTime").textContent = Math.floor((data.activeTime || 0)/60) + " मिनट";
        });
        modal.style.display = "flex";
      };

      document.getElementById("walletBtn").onclick = () => {
        const modal = document.getElementById("walletModal");
        db.ref("users/" + user.uid + "/balance").on("value", s => {
          document.getElementById("walletBalance").textContent = s.val() || 0;
        });
        modal.style.display = "flex";
      };

      document.getElementById("addMoneyBtn").onclick = () => {
        const amt = parseInt(document.getElementById("addAmount").value);
        if (amt >= 200) {
          db.ref("requests/").push({
            uid: user.uid,
            amount: amt,
            type: "add",
            status: "pending",
            timestamp: new Date().toISOString()
          });
          alert("अनुरोध भेजा गया। एडमिन अनुमति देगा।");
        } else {
          alert("कम से कम ₹200 जोड़ें");
        }
      };

      document.getElementById("withdrawBtn").onclick = () => {
        const amt = parseInt(document.getElementById("withdrawAmount").value);
        if (amt >= 4000) {
          db.ref("requests/").push({
            uid: user.uid,
            amount: amt,
            type: "withdraw",
            status: "pending",
            timestamp: new Date().toISOString()
          });
          alert("निकासी अनुरोध भेजा गया।");
        } else {
          alert("कम से कम ₹4000 निकालें");
        }
      };
    }

    function closeModal(id) {
      document.getElementById(id).style.display = "none";
    }

    // Boss System
    function loadBosses() {
      db.ref("bosses/").on("value", snap => {
        const select = document.getElementById("bossSelect");
        select.innerHTML = "<option value=''>कोई बॉस नहीं</option>";
        snap.forEach(child => {
          const boss = child.val();
          const opt = document.createElement("option");
          opt.value = child.key;
          opt.textContent = boss.name;
          select.appendChild(opt);
        });
      });

      document.getElementById("bossSelect").onchange = function () {
        const bossId = this.value;
        const list = document.getElementById("userList");
        list.innerHTML = "";
        if (!bossId) return;

        db.ref("referrals/" + bossId).on("value", snap => {
          snap.forEach(child => {
            const uid = child.val();
            db.ref("users/" + uid).once("value").then(u => {
              if (u.exists()) {
                const li = document.createElement("div");
                li.className = "user-item";
                li.innerHTML = `<span class="green-light"></span> ${u.val().displayName || u.val().email}`;
                list.appendChild(li);
              }
            });
          });
        });
      };
    }

    // Realtime Game Logic
    function setupRealtimeGame(user) {
      const coin = document.getElementById("coin");
      const resultDiv = document.getElementById("result");
      const countdown = document.getElementById("countdown");
      const betHeads = document.getElementById("betHeads");
      const betTails = document.getElementById("betTails");

      let currentBet = 0;

      // Bet buttons
      document.querySelectorAll(".bet-btn").forEach(btn => {
        btn.onclick = () => {
          currentBet = parseInt(btn.getAttribute("data-amount"));
          alert(`₹${currentBet} का दांव चयनित`);
        };
      });

      betHeads.onclick = () => {
        if (currentBet < 10 || currentBet > 2000) {
          alert("₹10 से ₹2000 के बीच दांव लगाएं");
          return;
        }
        db.ref("bets/" + user.uid).set({
          uid: user.uid,
          amount: currentBet,
          choice: "heads",
          timestamp: new Date().getTime()
        });
        alert("चित पर दांव लगाया");
      };

      betTails.onclick = () => {
        if (currentBet < 10 || currentBet > 2000) {
          alert("₹10 से ₹2000 के बीच दांव लगाएं");
          return;
        }
        db.ref("bets/" + user.uid).set({
          uid: user.uid,
          amount: currentBet,
          choice: "tails",
          timestamp: new Date().getTime()
        });
        alert("पट पर दांव लगाया");
      };

      // Listen for countdown
      db.ref("game/currentCountdown").on("value", snap => {
        const time = snap.val();
        if (time) {
          countdown.textContent = `अगला राउंड: ${time} सेकंड`;
          betHeads.disabled = false;
          betTails.disabled = false;
        } else {
          countdown.textContent = "राउंड समाप्त";
          betHeads.disabled = true;
          betTails.disabled = true;
        }
      });

      // Listen for result
      db.ref("game/lastResult").on("value", snap => {
        const res = snap.val();
        if (res) {
          coin.className = "coin flip";
          setTimeout(() => {
            coin.textContent = res === "heads" ? "चित" : res === "tails" ? "पट" : "जल गया";
            resultDiv.textContent = res === "burn" ? "सिक्का जल गया! कोई लाभ नहीं" : `परिणाम: ${res === "heads" ? "चित" : "पट"}`;
            coin.className = "coin";
          }, 2000);
        }
      });

      // Update wallet from balance
      db.ref("users/" + user.uid + "/balance").on("value", s => {
        document.getElementById("wallet").textContent = "₹" + (s.val() || 0);
      });
    }
  </script>
</body>
</html>
