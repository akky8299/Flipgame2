<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinKing Admin Panel - Game Management Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <style>
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .coin-animation {
            animation: flip 2s infinite;
        }
        @keyframes flip {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
            100% { transform: rotateY(360deg); }
        }
        .pulse-green {
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="glass-effect p-8 rounded-2xl shadow-2xl max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <i class="fas fa-crown text-yellow-400 text-4xl mb-4"></i>
                <h2 class="text-2xl font-bold text-white mb-2" data-key="adminLogin">Admin Login</h2>
            </div>
            <form id="loginForm">
                <div class="mb-4">
                    <input type="email" id="adminEmail" placeholder="Admin Email" 
                           class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                </div>
                <div class="mb-6">
                    <input type="password" id="adminPassword" placeholder="Password" 
                           class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                </div>
                <button type="submit" class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 rounded-lg transition-colors">
                    <i class="fas fa-sign-in-alt mr-2"></i><span data-key="login">Login</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Main Admin Panel -->
    <div id="adminPanel" class="hidden">
        <!-- Header -->
        <header class="glass-effect p-4 shadow-lg">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <i class="fas fa-crown text-yellow-400 text-3xl mr-3"></i>
                    <h1 class="text-2xl font-bold text-white" data-key="adminPanelTitle">CoinKing Admin Panel</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="langToggle" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-language mr-2"></i><span data-key="language">English</span>
                    </button>
                    <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sign-out-alt mr-2"></i><span data-key="logout">Logout</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="p-4">
            <div class="flex flex-wrap gap-2 mb-6">
                <button class="tab-btn active bg-yellow-500 hover:bg-yellow-600 text-black px-4 py-2 rounded-lg font-semibold transition-colors" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt mr-2"></i><span data-key="dashboard">Dashboard</span>
                </button>
                <button class="tab-btn bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg font-semibold transition-colors" data-tab="gameControl">
                    <i class="fas fa-gamepad mr-2"></i><span data-key="gameControl">Game Control</span>
                </button>
                <button class="tab-btn bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg font-semibold transition-colors" data-tab="bossManagement">
                    <i class="fas fa-users-cog mr-2"></i><span data-key="bossManagement">Boss Management</span>
                </button>
                <button class="tab-btn bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg font-semibold transition-colors" data-tab="userManagement">
                    <i class="fas fa-users mr-2"></i><span data-key="userManagement">User Management</span>
                </button>
                <button class="tab-btn bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg font-semibold transition-colors" data-tab="walletManagement">
                    <i class="fas fa-wallet mr-2"></i><span data-key="walletManagement">Wallet Management</span>
                </button>
                <button class="tab-btn bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg font-semibold transition-colors" data-tab="aiSettings">
                    <i class="fas fa-robot mr-2"></i><span data-key="aiSettings">AI Settings</span>
                </button>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="glass-effect p-6 rounded-2xl text-center">
                        <i class="fas fa-users text-blue-400 text-3xl mb-3"></i>
                        <h3 class="text-white text-lg font-semibold mb-2" data-key="totalUsers">Total Users</h3>
                        <p id="totalUsersCount" class="text-3xl font-bold text-blue-400">0</p>
                    </div>
                    <div class="glass-effect p-6 rounded-2xl text-center">
                        <i class="fas fa-circle text-green-400 text-3xl mb-3 pulse-green"></i>
                        <h3 class="text-white text-lg font-semibold mb-2" data-key="activeUsers">Active Users</h3>
                        <p id="activeUsersCount" class="text-3xl font-bold text-green-400">0</p>
                    </div>
                    <div class="glass-effect p-6 rounded-2xl text-center">
                        <i class="fas fa-coins text-yellow-400 text-3xl mb-3"></i>
                        <h3 class="text-white text-lg font-semibold mb-2" data-key="totalBets">Total Bets</h3>
                        <p id="totalBetsAmount" class="text-3xl font-bold text-yellow-400">₹0</p>
                    </div>
                    <div class="glass-effect p-6 rounded-2xl text-center">
                        <i class="fas fa-trophy text-purple-400 text-3xl mb-3"></i>
                        <h3 class="text-white text-lg font-semibold mb-2" data-key="totalProfit">Total Profit</h3>
                        <p id="totalProfitAmount" class="text-3xl font-bold text-purple-400">₹0</p>
                    </div>
                </div>

                <!-- Live Betting Chart -->
                <div class="glass-effect p-6 rounded-2xl mb-8">
                    <h3 class="text-white text-xl font-bold mb-4" data-key="liveBettingData">Live Betting Data</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div style="height: 300px;">
                            <canvas id="bettingChart"></canvas>
                        </div>
                        <div class="space-y-4">
                            <div class="bg-white bg-opacity-10 p-4 rounded-xl">
                                <div class="flex justify-between items-center">
                                    <span class="text-white font-semibold">Head Bets:</span>
                                    <span id="headBetsAmount" class="text-green-400 font-bold">₹0</span>
                                </div>
                            </div>
                            <div class="bg-white bg-opacity-10 p-4 rounded-xl">
                                <div class="flex justify-between items-center">
                                    <span class="text-white font-semibold">Tail Bets:</span>
                                    <span id="tailBetsAmount" class="text-red-400 font-bold">₹0</span>
                                </div>
                            </div>
                            <div class="bg-white bg-opacity-10 p-4 rounded-xl">
                                <div class="flex justify-between items-center">
                                    <span class="text-white font-semibold">Total Round Bets:</span>
                                    <span id="totalRoundBets" class="text-yellow-400 font-bold">₹0</span>
                                </div>
                            </div>
                            <div class="bg-white bg-opacity-10 p-4 rounded-xl">
                                <div class="flex justify-between items-center">
                                    <span class="text-white font-semibold">Active Bettors:</span>
                                    <span id="activeBettors" class="text-blue-400 font-bold">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Game Control Tab -->
            <div id="gameControl" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Game Timer Control -->
                    <div class="glass-effect p-6 rounded-2xl">
                        <h3 class="text-white text-xl font-bold mb-4" data-key="gameTimerControl">Game Timer Control</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="text-white font-semibold mb-2 block" data-key="setTimer">Set Timer (seconds):</label>
                                <input type="number" id="gameTimer" value="60" min="10" max="300" 
                                       class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                            </div>
                            <div class="flex gap-3">
                                <button id="startGameBtn" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg transition-colors">
                                    <i class="fas fa-play mr-2"></i><span data-key="startBetting">Start Betting</span>
                                </button>
                                <button id="resetGameBtn" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 rounded-lg transition-colors">
                                    <i class="fas fa-redo mr-2"></i><span data-key="reset">Reset</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Countdown Display -->
                        <div class="mt-6 text-center">
                            <div id="countdownDisplay" class="text-6xl font-bold text-yellow-400 mb-4">00:00</div>
                            <div id="gameStatus" class="text-white text-lg font-semibold" data-key="waitingToStart">Waiting to Start</div>
                        </div>
                    </div>

                    <!-- Result Control -->
                    <div class="glass-effect p-6 rounded-2xl">
                        <h3 class="text-white text-xl font-bold mb-4" data-key="resultControl">Result Control</h3>
                        <div class="space-y-4">
                            <div class="grid grid-cols-3 gap-3">
                                <button id="headResult" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-lg transition-colors">
                                    <i class="fas fa-coins text-2xl mb-2"></i>
                                    <div data-key="head">HEAD</div>
                                </button>
                                <button id="tailResult" class="bg-red-500 hover:bg-red-600 text-white font-bold py-4 rounded-lg transition-colors">
                                    <i class="fas fa-coins text-2xl mb-2 transform rotate-180"></i>
                                    <div data-key="tail">TAIL</div>
                                </button>
                                <button id="burnResult" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 rounded-lg transition-colors">
                                    <i class="fas fa-fire text-2xl mb-2"></i>
                                    <div data-key="burn">BURN</div>
                                </button>
                            </div>
                            
                            <!-- AI Recommendation -->
                            <div class="bg-white bg-opacity-10 p-4 rounded-xl">
                                <h4 class="text-white font-semibold mb-2" data-key="aiRecommendation">AI Recommendation:</h4>
                                <div id="aiRecommendationText" class="text-yellow-400 font-bold">Analyzing betting data...</div>
                            </div>

                            <!-- Auto Mode Toggle -->
                            <div class="flex items-center justify-between">
                                <span class="text-white font-semibold" data-key="autoMode">Auto Mode (AI):</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="autoModeToggle" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-yellow-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow-500"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Results -->
                <div class="glass-effect p-6 rounded-2xl mt-8">
                    <h3 class="text-white text-xl font-bold mb-4" data-key="recentResults">Recent Results</h3>
                    <div id="recentResultsList" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-3">
                        <!-- Recent results will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Boss Management Tab -->
            <div id="bossManagement" class="tab-content hidden">
                <div class="glass-effect p-6 rounded-2xl mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-white text-xl font-bold" data-key="bossManagement">Boss Management</h3>
                        <button id="addBossBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-plus mr-2"></i><span data-key="addBoss">Add Boss</span>
                        </button>
                    </div>
                    
                    <div id="bossList" class="space-y-4">
                        <!-- Boss list will be populated here -->
                    </div>
                </div>

                <!-- Add/Edit Boss Modal -->
                <div id="bossModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
                    <div class="glass-effect p-8 rounded-2xl shadow-2xl max-w-md w-full mx-4">
                        <h3 id="bossModalTitle" class="text-white text-xl font-bold mb-4" data-key="addBoss">Add Boss</h3>
                        <form id="bossForm">
                            <div class="mb-4">
                                <label class="text-white font-semibold mb-2 block" data-key="bossName">Boss Name:</label>
                                <input type="text" id="bossNameInput" required
                                       class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                            </div>
                            <div class="mb-6">
                                <label class="text-white font-semibold mb-2 block" data-key="referralId">Referral ID:</label>
                                <input type="text" id="referralIdInput" required
                                       class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-gray-300 border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                            </div>
                            <div class="flex gap-3">
                                <button type="submit" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg transition-colors">
                                    <i class="fas fa-save mr-2"></i><span data-key="save">Save</span>
                                </button>
                                <button type="button" id="cancelBossBtn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 rounded-lg transition-colors">
                                    <i class="fas fa-times mr-2"></i><span data-key="cancel">Cancel</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- User Management Tab -->
            <div id="userManagement" class="tab-content hidden">
                <div class="glass-effect p-6 rounded-2xl mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-white text-xl font-bold" data-key="userManagement">User Management</h3>
                        <div class="flex gap-3">
                            <select id="bossFilter" class="bg-white bg-opacity-20 text-white p-2 rounded-lg border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                                <option value="" data-key="allBosses">All Bosses</option>
                            </select>
                            <button id="refreshUsersBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                <i class="fas fa-sync mr-2"></i><span data-key="refresh">Refresh</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-white">
                            <thead>
                                <tr class="bg-white bg-opacity-10">
                                    <th class="p-3 text-left" data-key="status">Status</th>
                                    <th class="p-3 text-left" data-key="userName">User Name</th>
                                    <th class="p-3 text-left" data-key="boss">Boss</th>
                                    <th class="p-3 text-left" data-key="wallet">Wallet</th>
                                    <th class="p-3 text-left" data-key="totalProfit">Total Profit</th>
                                    <th class="p-3 text-left" data-key="totalLoss">Total Loss</th>
                                    <th class="p-3 text-left" data-key="activeTime">Active Time</th>
                                    <th class="p-3 text-left" data-key="actions">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Wallet Management Tab -->
            <div id="walletManagement" class="tab-content hidden">
                <div class="glass-effect p-6 rounded-2xl">
                    <h3 class="text-white text-xl font-bold mb-6" data-key="walletRequests">Wallet Requests</h3>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Add Money Requests -->
                        <div>
                            <h4 class="text-white text-lg font-semibold mb-4" data-key="addMoneyRequests">Add Money Requests</h4>
                            <div id="addMoneyRequests" class="space-y-4 max-h-96 overflow-y-auto">
                                <!-- Add money requests will be populated here -->
                            </div>
                        </div>

                        <!-- Withdrawal Requests -->
                        <div>
                            <h4 class="text-white text-lg font-semibold mb-4" data-key="withdrawalRequests">Withdrawal Requests</h4>
                            <div id="withdrawalRequests" class="space-y-4 max-h-96 overflow-y-auto">
                                <!-- Withdrawal requests will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Settings Tab -->
            <div id="aiSettings" class="tab-content hidden">
                <div class="glass-effect p-6 rounded-2xl">
                    <h3 class="text-white text-xl font-bold mb-6" data-key="aiSettings">AI Settings</h3>
                    
                    <div class="space-y-6">
                        <div class="bg-white bg-opacity-10 p-4 rounded-xl">
                            <h4 class="text-white font-semibold mb-2" data-key="aiStatus">AI Status</h4>
                            <div class="flex items-center gap-4">
                                <div id="aiStatusIndicator" class="w-4 h-4 bg-green-400 rounded-full pulse-green"></div>
                                <span id="aiStatusText" class="text-green-400 font-semibold">Active</span>
                            </div>
                        </div>

                        <div class="bg-white bg-opacity-10 p-4 rounded-xl">
                            <h4 class="text-white font-semibold mb-2" data-key="aiStrategy">AI Strategy</h4>
                            <select id="aiStrategy" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                                <option value="balanced" data-key="balanced">Balanced (Favor lower bets)</option>
                                <option value="aggressive" data-key="aggressive">Aggressive (House edge)</option>
                                <option value="random" data-key="random">Random</option>
                            </select>
                        </div>

                        <div class="bg-white bg-opacity-10 p-4 rounded-xl">
                            <h4 class="text-white font-semibold mb-2" data-key="autoCountdown">Auto Countdown</h4>
                            <div class="flex items-center justify-between">
                                <span class="text-white" data-key="enableAutoCountdown">Enable Auto Countdown:</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="autoCountdownToggle" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-yellow-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow-500"></div>
                                </label>
                            </div>
                        </div>

                        <div class="bg-white bg-opacity-10 p-4 rounded-xl">
                            <h4 class="text-white font-semibold mb-2" data-key="aiLog">AI Activity Log</h4>
                            <div id="aiLog" class="bg-black bg-opacity-30 p-3 rounded-lg h-48 overflow-y-auto text-sm text-gray-300 font-mono">
                                <div>AI System initialized...</div>
                                <div>Monitoring betting patterns...</div>
                                <div>Ready for game management...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBolnOupTsxH6haPUWnWv4gJOSiZgp-y30",
            authDomain: "coinking-d5d5e.firebaseapp.com",
            databaseURL: "https://coinking-d5d5e-default-rtdb.firebaseio.com",
            projectId: "coinking-d5d5e",
            storageBucket: "coinking-d5d5e.firebasestorage.app",
            messagingSenderId: "489710882522",
            appId: "1:489710882522:web:9fcecfd5b6ffd3c3d61fe3",
            measurementId: "G-D4HY1RHEWV"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // Gemini AI Configuration
        const GEMINI_API_KEY = 'AIzaSyDkRBSjzlCQ98BkuI37uQh_7ntHgVgMk6E';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

        // Language Support
        const translations = {
            en: {
                adminLogin: "Admin Login",
                login: "Login",
                logout: "Logout",
                language: "English",
                adminPanelTitle: "CoinKing Admin Panel",
                dashboard: "Dashboard",
                gameControl: "Game Control",
                bossManagement: "Boss Management",
                userManagement: "User Management",
                walletManagement: "Wallet Management",
                aiSettings: "AI Settings",
                totalUsers: "Total Users",
                activeUsers: "Active Users",
                totalBets: "Total Bets",
                totalProfit: "Total Profit",
                liveBettingData: "Live Betting Data",
                gameTimerControl: "Game Timer Control",
                setTimer: "Set Timer (seconds)",
                startBetting: "Start Betting",
                reset: "Reset",
                waitingToStart: "Waiting to Start",
                resultControl: "Result Control",
                head: "HEAD",
                tail: "TAIL",
                burn: "BURN",
                aiRecommendation: "AI Recommendation",
                autoMode: "Auto Mode (AI)",
                recentResults: "Recent Results",
                addBoss: "Add Boss",
                bossName: "Boss Name",
                referralId: "Referral ID",
                save: "Save",
                cancel: "Cancel",
                allBosses: "All Bosses",
                refresh: "Refresh",
                status: "Status",
                userName: "User Name",
                boss: "Boss",
                wallet: "Wallet",
                actions: "Actions",
                walletRequests: "Wallet Requests",
                addMoneyRequests: "Add Money Requests",
                withdrawalRequests: "Withdrawal Requests",
                aiStatus: "AI Status",
                aiStrategy: "AI Strategy",
                balanced: "Balanced (Favor lower bets)",
                aggressive: "Aggressive (House edge)",
                random: "Random",
                autoCountdown: "Auto Countdown",
                enableAutoCountdown: "Enable Auto Countdown",
                aiLog: "AI Activity Log",
                activeTime: "Active Time",
                totalLoss: "Total Loss"
            },
            hi: {
                adminLogin: "एडमिन लॉगिन",
                login: "लॉगिन",
                logout: "लॉगआउट",
                language: "हिंदी",
                adminPanelTitle: "कॉइनकिंग एडमिन पैनल",
                dashboard: "डैशबोर्ड",
                gameControl: "गेम कंट्रोल",
                bossManagement: "बॉस मैनेजमेंट",
                userManagement: "यूजर मैनेजमेंट",
                walletManagement: "वॉलेट मैनेजमेंट",
                aiSettings: "AI सेटिंग्स",
                totalUsers: "कुल यूजर्स",
                activeUsers: "सक्रिय यूजर्स",
                totalBets: "कुल दांव",
                totalProfit: "कुल लाभ",
                liveBettingData: "लाइव बेटिंग डेटा",
                gameTimerControl: "गेम टाइमर कंट्रोल",
                setTimer: "टाइमर सेट करें (सेकंड)",
                startBetting: "बेटिंग शुरू करें",
                reset: "रीसेट",
                waitingToStart: "शुरू होने की प्रतीक्षा",
                resultControl: "रिजल्ट कंट्रोल",
                head: "चित",
                tail: "पट",
                burn: "जला",
                aiRecommendation: "AI सुझाव",
                autoMode: "ऑटो मोड (AI)",
                recentResults: "हाल के परिणाम",
                addBoss: "बॉस जोड़ें",
                bossName: "बॉस का नाम",
                referralId: "रेफरल आईडी",
                save: "सेव करें",
                cancel: "रद्द करें",
                allBosses: "सभी बॉस",
                refresh: "रिफ्रेश",
                status: "स्थिति",
                userName: "यूजर नाम",
                boss: "बॉस",
                wallet: "वॉलेट",
                actions: "कार्य",
                walletRequests: "वॉलेट अनुरोध",
                addMoneyRequests: "पैसे जोड़ने के अनुरोध",
                withdrawalRequests: "निकासी अनुरोध",
                aiStatus: "AI स्थिति",
                aiStrategy: "AI रणनीति",
                balanced: "संतुलित (कम दांव को प्राथमिकता)",
                aggressive: "आक्रामक (हाउस एज)",
                random: "रैंडम",
                autoCountdown: "ऑटो काउंटडाउन",
                enableAutoCountdown: "ऑटो काउंटडाउन सक्षम करें",
                aiLog: "AI गतिविधि लॉग",
                activeTime: "सक्रिय समय",
                totalLoss: "कुल हानि"
            }
        };

        let currentLang = 'en';
        let gameTimer = null;
        let countdownTime = 0;
        let bettingChart = null;
        let currentBossId = null;
        let autoMode = false;
        let autoCountdown = false;

        // Initialize Admin Panel
        document.addEventListener('DOMContentLoaded', function() {
            initializeAdminPanel();
        });

        function initializeAdminPanel() {
            setupEventListeners();
            setupCharts();
            loadBosses();
            loadUsers();
            setupRealTimeListeners();
        }

        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Language toggle
            document.getElementById('langToggle').addEventListener('click', toggleLanguage);
            
            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });

            // Game control buttons
            document.getElementById('startGameBtn').addEventListener('click', startGame);
            document.getElementById('resetGameBtn').addEventListener('click', resetGame);
            
            // Result buttons
            document.getElementById('headResult').addEventListener('click', () => setResult('head'));
            document.getElementById('tailResult').addEventListener('click', () => setResult('tail'));
            document.getElementById('burnResult').addEventListener('click', () => setResult('burn'));
            
            // Auto mode toggle
            document.getElementById('autoModeToggle').addEventListener('change', function() {
                autoMode = this.checked;
                updateAILog(`Auto mode ${autoMode ? 'enabled' : 'disabled'}`);
            });

            // Auto countdown toggle
            document.getElementById('autoCountdownToggle').addEventListener('change', function() {
                autoCountdown = this.checked;
                updateAILog(`Auto countdown ${autoCountdown ? 'enabled' : 'disabled'}`);
            });

            // Boss management
            document.getElementById('addBossBtn').addEventListener('click', showBossModal);
            document.getElementById('bossForm').addEventListener('submit', saveBoss);
            document.getElementById('cancelBossBtn').addEventListener('click', hideBossModal);
            
            // User management
            document.getElementById('refreshUsersBtn').addEventListener('click', loadUsers);
            document.getElementById('bossFilter').addEventListener('change', filterUsers);
        }

        function setupCharts() {
            const ctx = document.getElementById('bettingChart').getContext('2d');
            bettingChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Head Bets', 'Tail Bets'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['#10b981', '#ef4444'],
                        borderColor: ['#059669', '#dc2626'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'white'
                            }
                        }
                    }
                }
            });
        }

        function setupRealTimeListeners() {
            // Listen for betting data
            database.ref('currentRound/bets').on('value', (snapshot) => {
                const bets = snapshot.val() || {};
                updateBettingData(bets);
            });

            // Listen for user activities
            database.ref('users').on('value', (snapshot) => {
                const users = snapshot.val() || {};
                updateUserStats(users);
            });

            // Listen for wallet requests
            database.ref('walletRequests').on('value', (snapshot) => {
                const requests = snapshot.val() || {};
                updateWalletRequests(requests);
            });
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            if (email === 'akky9453226641@gmail.com') {
                // Hide login modal and show admin panel
                document.getElementById('loginModal').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                
                // Initialize admin session
                await database.ref('adminSession').set({
                    email: email,
                    loginTime: firebase.database.ServerValue.TIMESTAMP,
                    status: 'online'
                });

                updateAILog('Admin logged in successfully');
            } else {
                alert('Invalid admin credentials');
            }
        }

        async function handleLogout() {
            await database.ref('adminSession').remove();
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            updateAILog('Admin logged out');
        }

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'hi' : 'en';
            updateLanguage();
        }

        function updateLanguage() {
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.getAttribute('data-key');
                if (translations[currentLang][key]) {
                    element.textContent = translations[currentLang][key];
                }
            });
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.remove('hidden');
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-yellow-500', 'hover:bg-yellow-600', 'text-black');
                btn.classList.add('bg-white', 'bg-opacity-20', 'hover:bg-opacity-30', 'text-white');
            });
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active', 'bg-yellow-500', 'hover:bg-yellow-600', 'text-black');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('bg-white', 'bg-opacity-20', 'hover:bg-opacity-30', 'text-white');
        }

        async function startGame() {
            const timerValue = parseInt(document.getElementById('gameTimer').value);
            countdownTime = timerValue;
            
            // Reset current round
            await database.ref('currentRound').set({
                status: 'betting',
                timeLeft: countdownTime,
                startTime: firebase.database.ServerValue.TIMESTAMP,
                bets: {},
                totalAmount: 0
            });

            // Start countdown
            startCountdown();
            updateAILog(`Game started with ${timerValue} seconds timer`);
        }

        function startCountdown() {
            document.getElementById('gameStatus').textContent = 'Betting Active';
            
            gameTimer = setInterval(async () => {
                countdownTime--;
                updateCountdownDisplay();
                
                // Update Firebase
                await database.ref('currentRound/timeLeft').set(countdownTime);
                
                if (countdownTime <= 0) {
                    clearInterval(gameTimer);
                    await endBettingPhase();
                }
            }, 1000);
        }

        function updateCountdownDisplay() {
            const minutes = Math.floor(countdownTime / 60);
            const seconds = countdownTime % 60;
            document.getElementById('countdownDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        async function endBettingPhase() {
            await database.ref('currentRound/status').set('waiting_result');
            document.getElementById('gameStatus').textContent = 'Waiting for Result';
            
            // AI recommendation
            if (autoMode) {
                const recommendation = await getAIRecommendation();
                setTimeout(() => setResult(recommendation), 2000);
            } else {
                const recommendation = await getAIRecommendation();
                document.getElementById('aiRecommendationText').textContent = 
                    `Recommend: ${recommendation.toUpperCase()}`;
            }
            
            updateAILog('Betting phase ended, waiting for result');
        }

        async function getAIRecommendation() {
            try {
                const betsSnapshot = await database.ref('currentRound/bets').once('value');
                const bets = betsSnapshot.val() || {};
                
                let headAmount = 0;
                let tailAmount = 0;
                
                Object.values(bets).forEach(bet => {
                    if (bet.choice === 'head') headAmount += bet.amount;
                    if (bet.choice === 'tail') tailAmount += bet.amount;
                });

                const strategy = document.getElementById('aiStrategy').value;
                
                if (strategy === 'balanced') {
                    // Favor the side with less money
                    if (headAmount < tailAmount) return 'head';
                    if (tailAmount < headAmount) return 'tail';
                    return 'burn';
                } else if (strategy === 'aggressive') {
                    // Favor house edge (side with more money loses)
                    if (headAmount > tailAmount) return 'tail';
                    if (tailAmount > headAmount) return 'head';
                    return 'burn';
                } else {
                    // Random
                    const options = ['head', 'tail', 'burn'];
                    return options[Math.floor(Math.random() * options.length)];
                }
            } catch (error) {
                updateAILog(`AI recommendation error: ${error.message}`);
                return 'burn';
            }
        }

        async function setResult(result) {
            try {
                // Set result in Firebase
                await database.ref('currentRound/result').set(result);
                await database.ref('currentRound/status').set('completed');
                
                // Process winnings
                await processWinnings(result);
                
                // Add to recent results
                await addToRecentResults(result);
                
                // Update display
                document.getElementById('gameStatus').textContent = `Result: ${result.toUpperCase()}`;
                
                updateAILog(`Result set: ${result.toUpperCase()}`);
                
                // Auto start next round if enabled
                if (autoCountdown) {
                    setTimeout(() => {
                        resetGame();
                        setTimeout(startGame, 2000);
                    }, 5000);
                }
            } catch (error) {
                updateAILog(`Error setting result: ${error.message}`);
            }
        }

        async function processWinnings(result) {
            const betsSnapshot = await database.ref('currentRound/bets').once('value');
            const bets = betsSnapshot.val() || {};
            
            for (const [userId, bet] of Object.entries(bets)) {
                const userRef = database.ref(`users/${userId}`);
                const userSnapshot = await userRef.once('value');
                const userData = userSnapshot.val();
                
                if (!userData) continue;
                
                let winAmount = 0;
                
                if (result === 'burn') {
                    // Return original bet amount (no profit, no loss)
                    winAmount = bet.amount;
                } else if (bet.choice === result) {
                    // Win: 2x the bet amount
                    winAmount = bet.amount * 2;
                }
                
                if (winAmount > 0) {
                    const newBalance = (userData.wallet || 0) + winAmount;
                    await userRef.update({
                        wallet: newBalance,
                        totalProfit: (userData.totalProfit || 0) + (winAmount - bet.amount),
                        gamesPlayed: (userData.gamesPlayed || 0) + 1
                    });
                } else {
                    await userRef.update({
                        totalLoss: (userData.totalLoss || 0) + bet.amount,
                        gamesPlayed: (userData.gamesPlayed || 0) + 1
                    });
                }
            }
        }

        async function addToRecentResults(result) {
            const resultsRef = database.ref('recentResults');
            const snapshot = await resultsRef.once('value');
            const results = snapshot.val() || [];
            
            results.unshift({
                result: result,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });
            
            // Keep only last 20 results
            if (results.length > 20) {
                results.splice(20);
            }
            
            await resultsRef.set(results);
            updateRecentResultsDisplay(results);
        }

        function updateRecentResultsDisplay(results) {
            const container = document.getElementById('recentResultsList');
            container.innerHTML = '';
            
            results.forEach(result => {
                const resultElement = document.createElement('div');
                resultElement.className = `p-3 rounded-lg text-center font-bold ${
                    result.result === 'head' ? 'bg-green-500' :
                    result.result === 'tail' ? 'bg-red-500' : 'bg-orange-500'
                }`;
                resultElement.textContent = result.result.toUpperCase();
                container.appendChild(resultElement);
            });
        }

        async function resetGame() {
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            
            countdownTime = 0;
            document.getElementById('countdownDisplay').textContent = '00:00';
            document.getElementById('gameStatus').textContent = 'Waiting to Start';
            document.getElementById('aiRecommendationText').textContent = 'Analyzing betting data...';
            
            // Clear current round
            await database.ref('currentRound').remove();
            
            updateAILog('Game reset');
        }

        function updateBettingData(bets) {
            let headAmount = 0;
            let tailAmount = 0;
            let totalAmount = 0;
            let activeBettors = 0;
            
            Object.values(bets).forEach(bet => {
                if (bet.choice === 'head') headAmount += bet.amount;
                if (bet.choice === 'tail') tailAmount += bet.amount;
                totalAmount += bet.amount;
                activeBettors++;
            });
            
            // Update display
            document.getElementById('headBetsAmount').textContent = `₹${headAmount}`;
            document.getElementById('tailBetsAmount').textContent = `₹${tailAmount}`;
            document.getElementById('totalRoundBets').textContent = `₹${totalAmount}`;
            document.getElementById('activeBettors').textContent = activeBettors;
            document.getElementById('totalBetsAmount').textContent = `₹${totalAmount}`;
            
            // Update chart
            if (bettingChart) {
                bettingChart.data.datasets[0].data = [headAmount, tailAmount];
                bettingChart.update();
            }
        }

        function updateUserStats(users) {
            let totalUsers = 0;
            let activeUsers = 0;
            let totalProfit = 0;
            
            Object.values(users).forEach(user => {
                totalUsers++;
                if (user.status === 'online') activeUsers++;
                totalProfit += user.totalProfit || 0;
            });
            
            document.getElementById('totalUsersCount').textContent = totalUsers;
            document.getElementById('activeUsersCount').textContent = activeUsers;
            document.getElementById('totalProfitAmount').textContent = `₹${totalProfit}`;
        }

        function showBossModal(boss = null) {
            currentBossId = boss ? boss.id : null;
            
            if (boss) {
                document.getElementById('bossModalTitle').textContent = 'Edit Boss';
                document.getElementById('bossNameInput').value = boss.name;
                document.getElementById('referralIdInput').value = boss.referralId;
            } else {
                document.getElementById('bossModalTitle').textContent = 'Add Boss';
                document.getElementById('bossNameInput').value = '';
                document.getElementById('referralIdInput').value = '';
            }
            
            document.getElementById('bossModal').classList.remove('hidden');
        }

        function hideBossModal() {
            document.getElementById('bossModal').classList.add('hidden');
            currentBossId = null;
        }

        async function saveBoss(e) {
            e.preventDefault();
            
            const name = document.getElementById('bossNameInput').value;
            const referralId = document.getElementById('referralIdInput').value;
            
            const bossData = {
                name: name,
                referralId: referralId,
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            if (currentBossId) {
                await database.ref(`bosses/${currentBossId}`).update(bossData);
            } else {
                await database.ref('bosses').push(bossData);
            }
            
            hideBossModal();
            loadBosses();
            updateAILog(`Boss ${currentBossId ? 'updated' : 'added'}: ${name}`);
        }

        async function loadBosses() {
            const snapshot = await database.ref('bosses').once('value');
            const bosses = snapshot.val() || {};
            
            const bossList = document.getElementById('bossList');
            const bossFilter = document.getElementById('bossFilter');
            
            bossList.innerHTML = '';
            bossFilter.innerHTML = '<option value="">All Bosses</option>';
            
            Object.entries(bosses).forEach(([id, boss]) => {
                // Boss list item
                const bossItem = document.createElement('div');
                bossItem.className = 'bg-white bg-opacity-10 p-4 rounded-xl flex justify-between items-center';
                bossItem.innerHTML = `
                    <div>
                        <h4 class="text-white font-semibold">${boss.name}</h4>
                        <p class="text-gray-300">Referral ID: ${boss.referralId}</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="showBossModal({id: '${id}', name: '${boss.name}', referralId: '${boss.referralId}'})" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteBoss('${id}')" 
                                class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                bossList.appendChild(bossItem);
                
                // Boss filter option
                const option = document.createElement('option');
                option.value = boss.referralId;
                option.textContent = boss.name;
                bossFilter.appendChild(option);
            });
        }

        async function deleteBoss(bossId) {
            if (confirm('Are you sure you want to delete this boss?')) {
                await database.ref(`bosses/${bossId}`).remove();
                loadBosses();
                updateAILog(`Boss deleted: ${bossId}`);
            }
        }

        async function loadUsers() {
            const snapshot = await database.ref('users').once('value');
            const users = snapshot.val() || {};
            
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            
            Object.entries(users).forEach(([id, user]) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-white border-opacity-10';
                
                const activeTime = calculateActiveTime(user.sessions || {});
                
                row.innerHTML = `
                    <td class="p-3">
                        <div class="w-3 h-3 rounded-full ${user.status === 'online' ? 'bg-green-400 pulse-green' : 'bg-gray-400'}"></div>
                    </td>
                    <td class="p-3">${user.name || 'Unknown'}</td>
                    <td class="p-3">${user.bossName || 'No Boss'}</td>
                    <td class="p-3">₹${user.wallet || 0}</td>
                    <td class="p-3 text-green-400">₹${user.totalProfit || 0}</td>
                    <td class="p-3 text-red-400">₹${user.totalLoss || 0}</td>
                    <td class="p-3">${activeTime}</td>
                    <td class="p-3">
                        <button onclick="viewUserDetails('${id}')" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm">
                            View
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function calculateActiveTime(sessions) {
            let totalTime = 0;
            Object.values(sessions).forEach(session => {
                if (session.endTime) {
                    totalTime += session.endTime - session.startTime;
                }
            });
            
            const hours = Math.floor(totalTime / 3600000);
            const minutes = Math.floor((totalTime % 3600000) / 60000);
            return `${hours}h ${minutes}m`;
        }

        function filterUsers() {
            const filterValue = document.getElementById('bossFilter').value;
            loadUsers(); // Reload and filter - in a real app, you'd implement proper filtering
        }

        function updateWalletRequests(requests) {
            const addMoneyContainer = document.getElementById('addMoneyRequests');
            const withdrawalContainer = document.getElementById('withdrawalRequests');
            
            addMoneyContainer.innerHTML = '';
            withdrawalContainer.innerHTML = '';
            
            Object.entries(requests).forEach(([id, request]) => {
                const requestElement = document.createElement('div');
                requestElement.className = 'bg-white bg-opacity-10 p-4 rounded-xl';
                requestElement.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-white font-semibold">${request.userName}</span>
                        <span class="text-yellow-400 font-bold">₹${request.amount}</span>
                    </div>
                    <div class="text-gray-300 text-sm mb-3">${new Date(request.timestamp).toLocaleString()}</div>
                    <div class="flex gap-2">
                        <button onclick="approveRequest('${id}', true)" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">
                            Approve
                        </button>
                        <button onclick="approveRequest('${id}', false)" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                            Reject
                        </button>
                    </div>
                `;
                
                if (request.type === 'add') {
                    addMoneyContainer.appendChild(requestElement);
                } else {
                    withdrawalContainer.appendChild(requestElement);
                }
            });
        }

        async function approveRequest(requestId, approved) {
            const requestRef = database.ref(`walletRequests/${requestId}`);
            const snapshot = await requestRef.once('value');
            const request = snapshot.val();
            
            if (!request) return;
            
            if (approved) {
                const userRef = database.ref(`users/${request.userId}`);
                const userSnapshot = await userRef.once('value');
                const userData = userSnapshot.val();
                
                if (userData) {
                    const currentWallet = userData.wallet || 0;
                    const newWallet = request.type === 'add' ? 
                        currentWallet + request.amount : 
                        currentWallet - request.amount;
                    
                    await userRef.update({ wallet: newWallet });
                }
            }
            
            await requestRef.remove();
            updateAILog(`Wallet request ${approved ? 'approved' : 'rejected'}: ₹${request.amount}`);
        }

        function updateAILog(message) {
            const logElement = document.getElementById('aiLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Make functions globally available
        window.showBossModal = showBossModal;
        window.deleteBoss = deleteBoss;
        window.approveRequest = approveRequest;
        window.viewUserDetails = function(userId) {
            // Implement user details modal
            alert(`View details for user: ${userId}`);
        };
    </script>
</body>
</html>
